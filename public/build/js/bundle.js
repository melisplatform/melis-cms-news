function charCounter(e){var s=$(this).val().length,t=$(this).prev("label"),i=e.data.limit;t.find("span").length?0===s?(t.removeClass("limit"),t.find("span").remove()):(t.find("span").html('<i class="fa fa-text-width"></i>('+s+")"),s>i?(t.addClass("limit"),t.find("span").addClass("limit")):(t.removeClass("limit"),t.find("span").removeClass("limit"))):0!==s&&(t.find(".label-text").append("<span class='text-counter-indicator'><i class='fa fa-text-width'></i>("+s+")</span>"),s>i&&(t.addClass("limit"),t.find("span").addClass("limit")))}$(function(){var e=$("body");e.on("click",".addNews",function(){var e=translations.tr_meliscmsnews_list_header_title_new;toolNews.tabOpen(e,0)}),e.on("click",".newsEdit",function(){var e=$(this),s=e.closest("tr").attr("id"),t=e.closest("tr").find("td:nth-child(3)").text();toolNews.tabOpen(t,s)}),e.on("click",".newsListRefresh",function(){toolNews.refreshTable()}),e.on("click",".newsDelete",function(){var e=$(this).closest("tr").attr("id"),s=[];s.push({name:"newsId",value:e}),melisCoreTool.pending(".newsDelete"),melisCoreTool.confirm(translations.tr_meliscmsnews_common_label_yes,translations.tr_meliscmsnews_common_label_no,translations.tr_meliscmsnews_common_label_delete_news,translations.tr_meliscmsnews_common_label_delete_confirm,function(){$.ajax({type:"POST",url:"/melis/MelisCmsNews/MelisCmsNewsList/deleteNews",data:s,dataType:"json",encode:!0}).done(function(s){s.success?(melisHelper.melisOkNotification(s.textTitle,s.textMessage),toolNews.tabClose(e),melisHelper.zoneReload("id_meliscmsnews_list_content_table","meliscmsnews_list_content_table",{})):melisHelper.melisKoNotification(s.textTitle,s.textMessage,s.errors),melisCore.flashMessenger()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),melisCoreTool.done(".newsDelete")}),e.on("click",".removeAttachFile",function(){var e=$(this),s=e.data("newsid"),t=e.data("column"),i=e.data("type"),a=[];a.push({name:"newsId",value:s}),a.push({name:"column",value:t}),a.push({name:"type",value:i}),melisCoreTool.pending(".removeAttachFile"),melisCoreTool.confirm(translations.tr_meliscmsnews_common_label_yes,translations.tr_meliscmsnews_common_label_no,melisHelper.melisTranslator("tr_meliscmsnews_delete_"+i+"_title"),melisHelper.melisTranslator("tr_meliscmsnews_delete_"+i+"_confirm_msg"),function(){$.ajax({type:"POST",url:"/melis/MelisCmsNews/MelisCmsNews/removeAttachFile",data:a,dataType:"json",encode:!0}).done(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(s+"_id_meliscmsnews_content_tabs_properties_details_left_images","meliscmsnews_content_tabs_properties_details_left_images",{newsId:s}),melisHelper.zoneReload(s+"_id_meliscmsnews_content_tabs_properties_details_left_documents","meliscmsnews_content_tabs_properties_details_left_documents",{newsId:s})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),melisCoreTool.done(".removeAttachFile")}),e.on("keyup","#cnews_title",function(){var e=$(this).closest(".container-level-a").data("newsid"),s=$(this).val(),t=($("#"+e+"_id_meliscmsnews_content_tabs_properties_details_right_paragraphs .news-post-text-form"),$("#"+e+"_id_meliscmsnews_content_tabs_properties_details_right_paragraphs").find("li.active a").attr("data-lang-id"));$("#"+e+"_id_meliscmsnews_content_tabs_seo_details #cnews_"+t).find("#cnews_seo_url").val();""==$("#"+e+"_id_meliscmsnews_content_tabs_seo_details #cnews_"+t).find('input[name="cnews_seo_id"]').val()&&$("#"+e+"_id_meliscmsnews_content_tabs_seo_details #cnews_"+t).find("#cnews_seo_url").val(s.replace(/\s+/g,"-").replace(/[^a-z0-9]+/gi,"-").replace(/^-+/,"").replace(/-+$/,"").toLowerCase())}),e.on("click",".saveNewsLetter",function(){var s=$(this);if(void 0===s.attr("disabled")){melisCoreTool.pending(".saveNewsLetter");var t=s.closest(".container-level-a"),i=t.find("form#newsLetterForm").serializeArray(),a=t.data("newsid"),n=t.find("select[name=cnews_slider_id]").val(),o=t.find("select[name=cnews_site_id]").val(),l=$("#"+a+"_id_meliscmsnews_content_tabs_properties_details_right_paragraphs .news-post-text-form"),r=0;l.each(function(){var e=$(this);i.push({name:"cnews_title["+r+"]",value:e.find("#cnews_title").val()}),i.push({name:"cnews_subtitle["+r+"]",value:e.find("#cnews_subtitle").val()}),i.push({name:"cnews_lang_id["+r+"]",value:e.data("langId")});for(var s=1;s<=10;s++)i.push({name:"cnews_paragraph"+s+"["+r+"]",value:e.find("textarea[name='cnews_paragraph"+s+"']").val()});var t="";e.find("textarea.editme").each(function(){t=""!=t?t+"-"+$(this).attr("name"):$(this).attr("name")}),i.push({name:"cnews_paragraph_order["+r+"]",value:t}),r++}),$("#"+a+"_id_meliscmsnews_content_tabs_seo_details .news-seo-form").each(function(e,s){var t=$(this).find("form").attr("name"),a=($("form[name="+t+"]").length,new FormData($(this).find("form")[0]).entries());for(var n of a)i.push({name:"cnews_seo["+e+"]["+n[0]+"]",value:n[1]})}),i.push({name:"formCount",value:l.length}),t.find(".make-switch div").each(function(){var e=$(this),s=e.find("input").attr("name"),t=e.hasClass("switch-on")?1:0;i.push({name:s,value:t})}),i.push({name:"cnews_slider_id",value:n}),i.push({name:"cnews_site_id",value:o}),$.ajax({type:"POST",url:"/melis/MelisCmsNews/MelisCmsNews/saveNewsLetter",data:i,dataType:"json",encode:!0}).done(function(s){if(s.success)toolNews.tabClose(a),melisHelper.melisOkNotification(s.textTitle,s.textMessage),toolNews.tabOpen(s.chunk.cnews_title,s.chunk.cnews_id),toolNews.refreshTable();else{if(melisHelper.melisKoNotification(s.textTitle,s.textMessage,s.errors),melisCoreTool.highlightErrors(s.success,s.errors,s.chunk.cnews_id+"_id_meliscmsnews_page form"),s.errors.hasOwnProperty("cnews_title")){var t=e.find("#"+s.chunk.cnews_id+"_id_meliscmsnews_content_tabs_properties_details_right_paragraphs label[for='cnews_title']");t.length&&t.css("color","red")}for(var i=["cnews_seo_meta_title","cnews_seo_meta_description","cnews_seo_canonical","cnews_seo_url","cnews_seo_url_redirect","cnews_seo_url_301"],n=i.length,o=0;o<n;o++)if(s.errors[i[o]]){var l=s.errors[i[o]].label,r=l.substring(l.indexOf("(")+1,l.lastIndexOf(")")),d=$("#"+a+"_id_meliscmsnews_content_tabs_seo_details").find("span:contains("+r+")").parent("a").attr("href");$("#"+s.chunk.cnews_id+"_id_meliscmsnews_content_tabs_seo_details .form-control[name="+i[o]+"]").parents(".form-group").children(":first").css("color","#686868"),$(d+" .form-control[name='"+i[o]+"']").parents(".form-group").children(":first").css("color","red")}}melisCore.flashMessenger(),melisCoreTool.done(".saveNewsLetter")})}}),e.on("click",".newsAttachFile",function(){melisCoreTool.pending(".newsAttachFile");var e=$(this),s=e.data("newsid"),t=e.data("filetype");melisHelper.createModal("id_meliscmsnews_modal_documents_form","meliscmsnews_modal_documents_form",!1,{newsId:s,type:t,isNew:1},"/melis/MelisCmsNews/MelisCmsNews/renderModal",function(){melisCoreTool.done(".newsAttachFile")})}),e.on("click",".newsAttachImage",function(){melisCoreTool.pending(".newsAttachImage");var e=$(this),s=e.data("newsid"),t=e.data("filetype");melisHelper.createModal("id_meliscmsnews_modal_documents_form_image","meliscmsnews_modal_documents_form_image",!1,{newsId:s,type:t,isNew:1},"/melis/MelisCmsNews/MelisCmsNews/renderModal",function(){melisCoreTool.done(".newsAttachImage")})}),e.on("click",".newsEditImage",function(){melisCoreTool.pending(".newsAttachImage");var e=$(this),s=e.data("newsid"),t=e.data("filetype"),i=e.data("column");melisHelper.createModal("id_meliscmsnews_modal_documents_form_image","meliscmsnews_modal_documents_form_image",!1,{newsId:s,type:t,isNew:0,column:i},"/melis/MelisCmsNews/MelisCmsNews/renderModal",function(){melisCoreTool.done(".newsAttachImage")})}),e.on("click","#newsAttachment",function(){var e=$(this);melisCoreTool.pending(e);var s=$("#newsFileForm").get(0),t=new FormData(s);$.ajax({type:"POST",url:"/melis/MelisCmsNews/MelisCmsNews/saveFileForm",data:t,dataType:"json",processData:!1,cache:!1,contentType:!1,encode:!0,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",toolNews.progress,!1),e}}).done(function(s){s.success?("image"===s.chunk.type?toolNews.imageModal(s.chunk):toolNews.fileModal(s.chunk),melisHelper.melisOkNotification(s.textTitle,s.textMessage,"#72af46"),melisCore.flashMessenger()):melisHelper.melisKoNotification(s.textTitle,s.textMessage,s.errors,"closeByButtonOnly"),$("div.progressContent").addClass("hidden"),melisCoreTool.done(e)}).fail(function(s,t){alert(translations.tr_meliscore_error_message),melisCoreTool.done(e)})}),e.on("change","select[name=cnews_site_id]",function(){var e=$(this).parents().eq(6).find("table").attr("id");$("#"+e).DataTable().ajax.reload()}),e.on("change",".mcnews-page-details",function(){var s=$(this),t=this.value,i=s.data();if(void 0!==i.newsId&&i.newsId>0&&void 0!==i.nameSpace.length&&i.nameSpace.length>0&&void 0!==t&&t>0){var a="/id/"+t+"/preview?melisSite="+i.nameSpace+"&newsId="+i.newsId+"&renderMode=previewtab",n=e.find("#"+i.newsId+"-see-below"),o=e.find("#"+i.newsId+"-see-in-new-tab");n.attr({"data-uri":a,disabled:!1}),o.attr({href:a,disabled:!1})}}),e.on("click",".preview-tab-see-below",function(){var e=this.id,s=this.dataset;void 0!==s.uri&&s.uri&&(e=e.split("-")[0])&&melisHelper.zoneReload(e+"_id_meliscmsnews_tabs_preview_iframe","meliscmsnews_tabs_preview_iframe",{newsId:e,newsUri:s.uri})}),e.on("click",".comments",function(){var e=$(this).attr("href"),s=$(e);melisCore.screenSize>768&&s.find(".comments-table-refresh").trigger("click")}),$(window).on("scroll",function(){var e=activeTabId.split("_")[0],s=$("#"+e+"_news-preview-iframe-container");if(!0===s.is(":visible")){var t=s.find("iframe"),i=t.height();0===s.find(".overlay-loader").length&&i<=800&&t.height(t.contents().height())}}),e.on("keyup keydown change","form[name='newsSeoForm'] input[name='cnews_seo_meta_title']",{limit:65},charCounter),e.on("keyup keydown change","form[name='newsSeoForm'] textarea[name='cnews_seo_meta_description']",{limit:255},charCounter)});var toolNews={refreshTable:function(){melisHelper.zoneReload("id_meliscmsnews_list_content_table","meliscmsnews_list_content_table",{})},tabOpen:function(e,s){melisHelper.tabOpen(e,"fa fa-list-alt",s+"_id_meliscmsnews_page","meliscmsnews_page",{newsId:s},"id_meliscmsnews_left_menu")},tabClose:function(e){melisHelper.tabClose(e+"_id_meliscmsnews_page")},imageModal:function(e){$("#id_meliscmsnews_modal_documents_form_image_container").modal("hide"),melisHelper.zoneReload(e.cnews_id+"_id_meliscmsnews_content_tabs_properties_details_left_images","meliscmsnews_content_tabs_properties_details_left_images",{newsId:e.cnews_id})},fileModal:function(e){$("#id_meliscmsnews_modal_documents_form_image_container").modal("hide"),$("#id_meliscmsnews_modal_documents_form_container").modal("hide"),melisHelper.zoneReload(e.cnews_id+"_id_meliscmsnews_content_tabs_properties_details_left_documents","meliscmsnews_content_tabs_properties_details_left_documents",{newsId:e.cnews_id})},trimLength:function(e){return(e=$.trim(e)).length>15?(e=e.substring(0,15-"...".length)).substring(0,e.lastIndexOf(" "))+"...":e},progress:function(e){var s=$("div.progressContent");s.removeClass("hidden");var t=$("div.progressContent > div.progress > div.progress-bar");t.attr("aria-valuenow",0),t.css("width","0%");var i=$("div.progressContent > div.progress > span.status");if(i.html(""),e.lengthComputable){var a=e.total,n=100*e.loaded/a;t.attr("aria-valuenow",n),t.css("width",n+"%"),n>100?s.addClass("hidden"):i.html(Math.round(n)+"%")}}};window.newsImagePreview=function(e,s){if(s.files&&s.files[0]){var t=new FileReader;t.onload=function(s){$(e).attr("src",s.target.result)},t.readAsDataURL(s.files[0])}},window.initNewsList=function(e){var s=$("#newsSiteSelect");s.length&&(e.cnews_site_id=s.val())},function(e){"use strict";e.fn.bootstrapSwitch=function(s){var t='input[type!="hidden"]',i={init:function(){return this.each(function(){var s,i,a,n,o,l,r=e(this),d=r.closest("form"),c="",m=r.attr("class"),w="ON",f="OFF",_=!1,h=!1;e.each(["switch-mini","switch-small","switch-large"],function(e,s){m.indexOf(s)>=0&&(c=s)}),r.addClass("has-switch"),void 0!==r.data("on")&&(o="switch-"+r.data("on")),void 0!==r.data("on-label")&&(w=r.data("on-label")),void 0!==r.data("off-label")&&(f=r.data("off-label")),void 0!==r.data("label-icon")&&(_=r.data("label-icon")),void 0!==r.data("text-label")&&(h=r.data("text-label")),i=e("<span>").addClass("switch-left").addClass(c).addClass(o).html(w),o="",void 0!==r.data("off")&&(o="switch-"+r.data("off")),a=e("<span>").addClass("switch-right").addClass(c).addClass(o).html(f),n=e("<label>").html("&nbsp;").addClass(c).attr("for",r.find(t).attr("id")),_&&n.html('<i class="icon '+_+'"></i>'),h&&n.html(""+h),s=r.find(t).wrap(e("<div>")).parent().data("animated",!1),!1!==r.data("animated")&&s.addClass("switch-animate").data("animated",!0),s.append(i).append(n).append(a),r.find(">div").addClass(r.find(t).is(":checked")?"switch-on":"switch-off"),r.find(t).is(":disabled")&&e(this).addClass("deactivate");var u=function(e){r.parent("label").is(".label-change-switch")||e.siblings("label").trigger("mousedown").trigger("mouseup").trigger("click")};r.on("keydown",function(s){32===s.keyCode&&(s.stopImmediatePropagation(),s.preventDefault(),u(e(s.target).find("span:first")))}),i.on("click",function(s){u(e(this))}),a.on("click",function(s){u(e(this))}),r.find(t).on("change",function(s,t){var i=e(this),a=i.parent(),n=i.is(":checked"),o=a.is(".switch-off");if(s.preventDefault(),a.css("left",""),o===n){if(n?a.removeClass("switch-off").addClass("switch-on"):a.removeClass("switch-on").addClass("switch-off"),!1!==a.data("animated")&&a.addClass("switch-animate"),"boolean"==typeof t&&t)return;a.parent().trigger("switch-change",{el:i,value:n})}}),r.find("label").on("mousedown touchstart",function(s){var t=e(this);l=!1,s.preventDefault(),s.stopImmediatePropagation(),t.closest("div").removeClass("switch-animate"),t.closest(".has-switch").is(".deactivate")?t.unbind("click"):t.closest(".switch-on").parent().is(".radio-no-uncheck")?t.unbind("click"):(t.on("mousemove touchmove",function(s){var t=e(this).closest(".make-switch"),i=((s.pageX||s.originalEvent.targetTouches[0].pageX)-t.offset().left)/t.width()*100;l=!0,i<25?i=25:i>75&&(i=75),t.find(">div").css("left",i-75+"%")}),t.on("click touchend",function(s){var t=e(this),i=e(s.target).siblings("input");s.stopImmediatePropagation(),s.preventDefault(),t.unbind("mouseleave"),l?i.prop("checked",!(parseInt(t.parent().css("left"))<-25)):i.prop("checked",!i.is(":checked")),l=!1,i.trigger("change")}),t.on("mouseleave",function(s){var t=e(this),i=t.siblings("input");s.preventDefault(),s.stopImmediatePropagation(),t.unbind("mouseleave"),t.trigger("mouseup"),i.prop("checked",!(parseInt(t.parent().css("left"))<-25)).trigger("change")}),t.on("mouseup",function(s){s.stopImmediatePropagation(),s.preventDefault(),e(this).unbind("mousemove")}))}),"injected"!==d.data("bootstrapSwitch")&&(d.bind("reset",function(){setTimeout(function(){d.find(".make-switch").each(function(){var s=e(this).find(t);s.prop("checked",s.is(":checked")).trigger("change")})},1)}),d.data("bootstrapSwitch","injected"))})},toggleActivation:function(){var s=e(this);s.toggleClass("deactivate"),s.find(t).prop("disabled",s.is(".deactivate"))},isActive:function(){return!e(this).hasClass("deactivate")},setActive:function(s){var i=e(this);s?(i.removeClass("deactivate"),i.find(t).removeAttr("disabled")):(i.addClass("deactivate"),i.find(t).attr("disabled","disabled"))},toggleState:function(s){var t=e(this).find(":checkbox");t.prop("checked",!t.is(":checked")).trigger("change",s)},toggleRadioState:function(s){var t=e(this).find(":radio");t.not(":checked").prop("checked",!t.is(":checked")).trigger("change",s)},toggleRadioStateAllowUncheck:function(s,t){var i=e(this).find(":radio");s?i.not(":checked").trigger("change",t):i.not(":checked").prop("checked",!i.is(":checked")).trigger("change",t)},setState:function(s,i){e(this).find(t).prop("checked",s).trigger("change",i)},setOnLabel:function(s){e(this).find(".switch-left").html(s)},setOffLabel:function(s){e(this).find(".switch-right").html(s)},setOnClass:function(s){var t=e(this).find(".switch-left"),i="";void 0!==s&&(void 0!==e(this).attr("data-on")&&(i="switch-"+e(this).attr("data-on")),t.removeClass(i),i="switch-"+s,t.addClass(i))},setOffClass:function(s){var t=e(this).find(".switch-right"),i="";void 0!==s&&(void 0!==e(this).attr("data-off")&&(i="switch-"+e(this).attr("data-off")),t.removeClass(i),i="switch-"+s,t.addClass(i))},setAnimated:function(s){var i=e(this).find(t).parent();void 0===s&&(s=!1),i.data("animated",s),i.attr("data-animated",s),!1!==i.data("animated")?i.addClass("switch-animate"):i.removeClass("switch-animate")},setSizeClass:function(s){var t=e(this),i=t.find(".switch-left"),a=t.find(".switch-right"),n=t.find("label");e.each(["switch-mini","switch-small","switch-large"],function(e,t){t!==s?(i.removeClass(t),a.removeClass(t),n.removeClass(t)):(i.addClass(t),a.addClass(t),n.addClass(t))})},status:function(){return e(this).find(t).is(":checked")},destroy:function(){var s,t=e(this),i=t.find("div"),a=t.closest("form");return i.find(":not(input)").remove(),(s=i.children()).unwrap().unwrap(),s.unbind("change"),a&&(a.unbind("reset"),a.removeData("bootstrapSwitch")),s}};return i[s]?i[s].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof s&&s?void e.error("Method "+s+" does not exist!"):i.init.apply(this,arguments)}}(jQuery),$(function(){var e=$("body"),s="";e.on("click",".meliscmsnews-dashboard-workflow .d-workflow-action-cont  span:not('.wd-see')",function(){var e=$(this),t=e.hasClass("wd-validate")?"validate":"refuse",i=e.parents(".wd-cont").data();i["wfe-id"]=e.data("wfe-id"),i.wfe_wf_id=e.data("wfe-wf-id");var a=e.parents(".grid-stack-item").data("gsId"),n=i.wfId;s=t,melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations["tr_meliscmsnews_workflow_"+t+"_notification_heading"],translations["tr_meliscmsnews_workflow_"+t+"_notification_message"],function(){$.ajax({url:"/melis/MelisCmsNews/MelisCmsNewsWorkflow/saveWorkflowActions?wfaction="+t,data:i,encode:!0}).done(function(e){if(1===e.success){$("div[data-gs-id='"+a+"'] .dashboard-plugin-refresh").trigger("click"),melisCore.flashMessenger(),melisHelper.melisOkNotification(e.textTitle,e.textMessage);melisHelper.createModal("id_meliscmsnews_dashboard_workflow_comment_modal_content","meliscmsnews_dashboard_workflow_comment_modal_content",!1,{cnews_com_news_id:n,action:s,pluginId:a},"/melis/MelisCmsNews/MelisCmsNewsWorkflow/workflowCommentModal")}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)}).fail(function(e,s,t){alert("ERROR !! Status = "+s+"\n Error = "+t+"\n xhr = "+e.statusText)})})}),e.on("click",".dashboard-workflow-tabs-news .dashboard-widget-workflow ul.list li:not('i.fa')",function(e){var s=$(this);"I"!==e.target.nodeName&&(s.find(".wd-cont-content").slideToggle(),s.find("span.fa-arrow-down").toggleClass("move-arrow"))}),e.on("click",".btnAddWorkflowCommentFromDashboardNews, .btnNoWorkflowCommentFromDashboardNews",function(e){var s="news-db-wf-comment-modal-"+$(this).data("pluginId"),t="";$(this).hasClass("btnAddWorkflowCommentFromDashboardNews")?t=".btnAddWorkflowCommentFromDashboardNews":($("#id_cnews_com_text").val(""),t=".btnNoWorkflowCommentFromDashboardNews");var i=$("#"+s).serializeArray();i=$.param(i),melisCoreTool.pending(t),$.ajax({type:"POST",url:"/melis/MelisCmsNews/MelisCmsNewsWorkflow/addWorkflowComments",data:i,dataType:"json",encode:!0}).done(function(e){e.success?$("#id_meliscmsnews_dashboard_workflow_comment_modal_content_container").modal("hide"):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0),melisCoreTool.highlightErrors(e.success,e.errors,s)),melisCore.flashMessenger(),melisCoreTool.done(t)}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e.on("click",".news-details-workflow",function(){var e=$(this);if(null==e.attr("disabled")){var s=e.data();melisCoreTool.pending(".news-details-workflow"),$.ajax({url:"/melis/MelisCmsNews/MelisCmsNewsWorkflow/render-workflow-modal",encode:!0}).done(function(e){$("#melis-modals-container").append(e),$("#melis-modals-container").find(".modal-content").data(s);var t=$(e).find(".modal").attr("id");melisHelper.zoneReload("id_meliscmsnews_workflow_modal_content","meliscmsnews_workflow_modal_content",s),$("#"+t).modal({show:!0}),melisCoreTool.done(".news-details-workflow")}).fail(function(e,s,t){melisCoreTool.done(".news-details-workflow"),alert(translations.tr_meliscore_error_message)})}}),e.on("click",".workflow-modal-cont-news .wbtn-cont .pw-show-ask",function(){$(this).parents(".workflow-modal-cont-news").find(".w-asktovalidate-cont-news").slideToggle(500)}),e.on("click",".w-asktovalidate-cont-news .dropdown-menu li a",function(){var e=$(this),s=e.data("text"),t=e.data("id");e.parents(".filter-cont").attr("data-id",t),e.parents(".filter-cont").find("span.filter-key").text(s)}),e.on("click",".w-asktovalidate-cont-news .pw-roles .dropdown-menu li a",function(){var e=$(this).data("id");$(".pw-users").append('<div id="loader" class="overlay-loader button-loader"><img class="loader-icon spinning-cog" src="/MelisCore/assets/images/cog12.svg" data-cog="cog12"></div>'),$.ajax({url:"/melis/MelisCmsNews/MelisCmsNewsWorkflow/getUserListPerRole?roleId="+e,encode:!0}).done(function(e){$(".loader-icon").removeClass("spinning-cog").addClass("shrinking-cog"),$(".pw-users #loader, .pw-users .button-mask-overlay").delay(350).fadeOut(0,function(){$(".pw-users #loader").remove()}),""!==e&&0!==e.length||$(".pw-users .button-mask-overlay").fadeIn(0),$(".pw-users ul.dropdown-menu").html(e)}).fail(function(e,s,t){alert("ERROR !! Status = "+s+"\n Error = "+t+"\n xhr = "+e.statusText)})}),e.on("click",".workflow-modal-cont-news .w-asktovalidate-cont-news .send-workflow-request",function(){var e=$(this),t=(activeTabId.split("_")[0],e.siblings(".pw-users").data("id")),i=e.siblings(".pw-roles").data("id"),a=(e.parents(".modal-content").find("div[data-meliskey]").attr("id"),e.parents(".modal-content").find("div[data-meliskey]").attr("data-meliskey"),e.parents(".modal-content").data(),e.parents(".modal-content").data());a.user=t,a.roles=i,a.ask="ask",s=a.ask,e.attr("disabled")||($(".workflow-modal-cont-news .w-asktovalidate-cont-news .send-workflow-request").attr("disabled",!0),$.ajax({url:"/melis/MelisCmsNews/MelisCmsNewsWorkflow/saveWorkflowAsk",data:a,encode:!0}).done(function(e){1===e.success?(melisCore.flashMessenger(),melisHelper.melisOkNotification(e.textTitle,e.textMessage),$("#workflow-comments-modal form#idmeliscmsnewscomments #id_cnews_com_title").attr("disabled","disabled"),$("#workflow-comments-modal form#idmeliscmsnewscomments #id_cnews_com_title").parent().hide(),$("#workflowCommentModalNews").modal("show"),$(document).on("show.bs.modal","#workflowCommentModalNews",function(){$(".workflow-modal-cont-news .w-asktovalidate-cont-news .send-workflow-request").removeAttr("disabled")})):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),$(".workflow-modal-cont-news .w-asktovalidate-cont-news .send-workflow-request").removeAttr("disabled"))}).fail(function(e,s,t){alert("ERROR !! Status = "+s+"\n Error = "+t+"\n xhr = "+e.statusText),$(".workflow-modal-cont-news .w-asktovalidate-cont-news .send-workflow-request").removeAttr("disabled")}))}),e.on("click",".workflow-modal-cont-news .btn-validate-refuse",function(){var e=$(this),t=(activeTabId.split("_")[0],e.parents(".modal-content").data());t["wfe-id"]=e.data("wfe-id"),t.wfe_wf_id=e.data("wfe_wf_id");e.parents(".modal-content").find("div[data-meliskey]").attr("id"),e.parents(".modal-content").find("div[data-meliskey]").attr("data-meliskey");var i=e.hasClass("pw-validate")?"validate":"refuse";s=i,melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations["tr_meliscmsnews_workflow_"+i+"_notification_heading"],translations["tr_meliscmsnews_workflow_"+i+"_notification_message"],function(){$.ajax({url:"/melis/MelisCmsNews/MelisCmsNewsWorkflow/saveWorkflowActions?wfaction="+i,data:t,encode:!0}).done(function(e){1===e.success?($("#workflow-comments-modal form#idmeliscmsnewscomments #id_cnews_com_title").attr("disabled","disabled"),$("#workflow-comments-modal form#idmeliscmsnewscomments #id_cnews_com_title").parent().hide(),$("#workflowCommentModalNews").modal("show"),melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),melisCore.flashMessenger()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)}).fail(function(e,s,t){alert("ERROR !! Status = "+s+"\n Error = "+t+"\n xhr = "+e.statusText)})})}),e.on("keyup blur","#idmeliscmsnewscomments #id_cnews_com_text",function(e){""!=$(this).val()?$(".btnAddWorkflowCommentNews").removeAttr("disabled"):$(".btnAddWorkflowCommentNews").attr("disabled","disabled")}),e.on("click",".btnAddWorkflowCommentNews, .btnCommentModalCloseNews",function(e){var t=$("#melis-modals-container").find(".modal-content").data("wf-id"),i="workflow-comments-modal form#idmeliscmsnewscomments",a=s,n="";$(this).hasClass("btnAddWorkflowCommentNews")?n=".btnAddWorkflowCommentNews":($("#id_cnews_com_text").val(""),n=".btnCommentModalCloseNews"),melisCoreTool.pending(n);var o=$("#"+i).serializeArray();o.push({name:"cnews_com_news_id",value:t}),o.push({name:"action",value:a}),o=$.param(o),$.ajax({type:"POST",url:"/melis/MelisCmsNews/MelisCmsNewsWorkflow/addWorkflowComments",data:o,dataType:"json",encode:!0}).done(function(e){e.success?(melisHelper.zoneReload(t+"_id_meliscmsnews_center_workflow_tabs_comments_timeline","meliscmsnews_workflow_comments_timeline",{newsId:t}),melisCoreTool.clearForm(i),$("#workflowCommentModalNews").modal("hide"),$("#newsWorkflowModal").modal("hide")):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0),melisCoreTool.highlightErrors(e.success,e.errors,i)),melisCore.flashMessenger(),melisCoreTool.done(n)}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e.on("click",".btnAddNewsComment",function(e){var s=$(this),t=s.data("newsid"),i=t+"_id_meliscmsnews_center_page_tabs_comments_add form#idmeliscmsnewscomments",a=$("#"+i).serializeArray();a.push({name:"cnews_com_news_id",value:t}),a=$.param(a),s.attr("disabled",!0),$.ajax({type:"POST",url:"/melis/MelisCmsNews/MelisCmsNewsWorkflowComments/addComment",data:a,dataType:"json",encode:!0}).done(function(e){e.success?(melisHelper.zoneReload(t+"_id_meliscmsnews_center_workflow_tabs_comments_timeline","meliscmsnews_workflow_comments_timeline",{newsId:t}),melisCoreTool.clearForm(i)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,i)),melisCore.flashMessenger()}).fail(function(){alert(translations.tr_meliscore_error_message)})})});
