$(function(){var e=$("body");e.on("click",".addNews",function(){var e=translations.tr_meliscmsnews_list_header_title_new;toolNews.tabOpen(e,0)}),e.on("click",".newsEdit",function(){var e=$(this),t=e.closest("tr").attr("id"),s=e.closest("tr").find("td:nth-child(3)").text();toolNews.tabOpen(s,t)}),e.on("click",".newsListRefresh",function(){toolNews.refreshTable()}),e.on("click",".newsDelete",function(){var e=$(this),t=e.closest("tr").attr("id"),s=[];s.push({name:"newsId",value:t}),melisCoreTool.pending(".newsDelete"),melisCoreTool.confirm(translations.tr_meliscmsnews_common_label_yes,translations.tr_meliscmsnews_common_label_no,translations.tr_meliscmsnews_common_label_delete_news,translations.tr_meliscmsnews_common_label_delete_confirm,function(){$.ajax({type:"POST",url:"/melis/MelisCmsNews/MelisCmsNewsList/deleteNews",data:s,dataType:"json",encode:!0}).done(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),toolNews.tabClose(t),melisHelper.zoneReload("id_meliscmsnews_list_content_table","meliscmsnews_list_content_table",{})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),melisCoreTool.done(".newsDelete")}),e.on("click",".removeAttachFile",function(){var e=$(this),t=e.data("newsid"),s=e.data("column"),i=e.data("type"),a=[];a.push({name:"newsId",value:t}),a.push({name:"column",value:s}),a.push({name:"type",value:i}),melisCoreTool.pending(".removeAttachFile"),melisCoreTool.confirm(translations.tr_meliscmsnews_common_label_yes,translations.tr_meliscmsnews_common_label_no,melisHelper.melisTranslator("tr_meliscmsnews_delete_"+i+"_title"),melisHelper.melisTranslator("tr_meliscmsnews_delete_"+i+"_confirm_msg"),function(){$.ajax({type:"POST",url:"/melis/MelisCmsNews/MelisCmsNews/removeAttachFile",data:a,dataType:"json",encode:!0}).done(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(t+"_id_meliscmsnews_content_tabs_properties_details_left_images","meliscmsnews_content_tabs_properties_details_left_images",{newsId:t}),melisHelper.zoneReload(t+"_id_meliscmsnews_content_tabs_properties_details_left_documents","meliscmsnews_content_tabs_properties_details_left_documents",{newsId:t})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),melisCoreTool.done(".removeAttachFile")}),e.on("click",".saveNewsLetter",function(){var t=$(this);if(void 0===t.attr("disabled")){melisCoreTool.pending(".saveNewsLetter");var s=t.closest(".container-level-a"),i=s.find("form#newsLetterForm").serializeArray(),a=s.data("newsid"),n=s.find("select[name=cnews_slider_id]").val(),o=s.find("select[name=cnews_site_id]").val(),l=$("#"+a+"_id_meliscmsnews_content_tabs_properties_details_right_paragraphs .news-post-text-form"),r=0;l.each(function(){var e=$(this);i.push({name:"cnews_title["+r+"]",value:e.find("#cnews_title").val()}),i.push({name:"cnews_subtitle["+r+"]",value:e.find("#cnews_subtitle").val()}),i.push({name:"cnews_lang_id["+r+"]",value:e.data("langId")});for(var t=1;t<=4;t++)i.push({name:"cnews_paragraph"+t+"["+r+"]",value:e.find("#cnews_paragraph"+t).val()});r++}),i.push({name:"formCount",value:l.length}),s.find(".make-switch div").each(function(){var e=$(this),t=e.find("input").attr("name"),s=e.hasClass("switch-on"),a=s?1:0;i.push({name:t,value:a})}),i.push({name:"cnews_slider_id",value:n}),i.push({name:"cnews_site_id",value:o}),$.ajax({type:"POST",url:"/melis/MelisCmsNews/MelisCmsNews/saveNewsLetter",data:i,dataType:"json",encode:!0}).done(function(t){if(t.success)toolNews.tabClose(a),melisHelper.melisOkNotification(t.textTitle,t.textMessage),toolNews.tabOpen(t.chunk.cnews_title,t.chunk.cnews_id),toolNews.refreshTable();else if(melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),melisCoreTool.highlightErrors(t.success,t.errors,t.chunk.cnews_id+"_id_meliscmsnews_page form"),t.errors.hasOwnProperty("cnews_title")){var s=e.find("#"+t.chunk.cnews_id+"_id_meliscmsnews_content_tabs_properties_details_right_paragraphs label[for='cnews_title']");s.length&&s.css("color","red")}melisCore.flashMessenger(),melisCoreTool.done(".saveNewsLetter")})}}),e.on("click",".newsAttachFile",function(){melisCoreTool.pending(".newsAttachFile");var e=$(this),t=e.data("newsid"),s=e.data("filetype");melisHelper.createModal("id_meliscmsnews_modal_documents_form","meliscmsnews_modal_documents_form",!1,{newsId:t,type:s,isNew:1},"/melis/MelisCmsNews/MelisCmsNews/renderModal",function(){melisCoreTool.done(".newsAttachFile")})}),e.on("click",".newsAttachImage",function(){melisCoreTool.pending(".newsAttachImage");var e=$(this),t=e.data("newsid"),s=e.data("filetype");melisHelper.createModal("id_meliscmsnews_modal_documents_form_image","meliscmsnews_modal_documents_form_image",!1,{newsId:t,type:s,isNew:1},"/melis/MelisCmsNews/MelisCmsNews/renderModal",function(){melisCoreTool.done(".newsAttachImage")})}),e.on("click",".newsEditImage",function(){melisCoreTool.pending(".newsAttachImage");var e=$(this),t=e.data("newsid"),s=e.data("filetype"),i=e.data("column");melisHelper.createModal("id_meliscmsnews_modal_documents_form_image","meliscmsnews_modal_documents_form_image",!1,{newsId:t,type:s,isNew:0,column:i},"/melis/MelisCmsNews/MelisCmsNews/renderModal",function(){melisCoreTool.done(".newsAttachImage")})}),e.on("click","#newsAttachment",function(){var e=$(this);melisCoreTool.pending(e);var t=$("#newsFileForm").get(0),s=new FormData(t);$.ajax({type:"POST",url:"/melis/MelisCmsNews/MelisCmsNews/saveFileForm",data:s,dataType:"json",processData:!1,cache:!1,contentType:!1,encode:!0,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",toolNews.progress,!1),e}}).done(function(t){t.success?("image"===t.chunk.type?toolNews.imageModal(t.chunk):toolNews.fileModal(t.chunk),melisHelper.melisOkNotification(t.textTitle,t.textMessage,"#72af46"),melisCore.flashMessenger()):melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors,"closeByButtonOnly"),$("div.progressContent").addClass("hidden"),melisCoreTool.done(e)}).fail(function(t,s){alert(translations.tr_meliscore_error_message),melisCoreTool.done(e)})}),e.on("change","select[name=cnews_site_id]",function(){var e=$(this).parents().eq(6).find("table").attr("id");$("#"+e).DataTable().ajax.reload()}),e.on("change",".mcnews-page-details",function(){var t=$(this),s=this.value,i=t.data();if(void 0!==i.newsId&&i.newsId>0&&void 0!==i.nameSpace.length&&i.nameSpace.length>0&&void 0!==s&&s>0){var a="/id/"+s+"/preview?melisSite="+i.nameSpace+"&newsId="+i.newsId+"&renderMode=previewtab",n=e.find("#"+i.newsId+"-see-below"),o=e.find("#"+i.newsId+"-see-in-new-tab");n.attr({"data-uri":a,disabled:!1}),o.attr({href:a,disabled:!1})}}),e.on("click",".preview-tab-see-below",function(){var e=this.id,t=this.dataset;void 0!==t.uri&&t.uri&&(e=e.split("-")[0])&&melisHelper.zoneReload(e+"_id_meliscmsnews_tabs_preview_iframe","meliscmsnews_tabs_preview_iframe",{newsId:e,newsUri:t.uri})}),e.on("click",".comments",function(){var e=$(this),t=e.attr("href"),s=$(t);melisCore.screenSize>768&&s.find(".comments-table-refresh").trigger("click")}),$(window).on("scroll",function(){var e=activeTabId.split("_")[0],t=$("#"+e+"_news-preview-iframe-container");if(!0===t.is(":visible")){var s=t.find("iframe"),i=s.height();0===t.find(".overlay-loader").length&&i<=800&&s.height(s.contents().height())}})});var toolNews={refreshTable:function(){melisHelper.zoneReload("id_meliscmsnews_list_content_table","meliscmsnews_list_content_table",{})},tabOpen:function(e,t){melisHelper.tabOpen(e,"fa fa-list-alt",t+"_id_meliscmsnews_page","meliscmsnews_page",{newsId:t},"id_meliscmsnews_left_menu")},tabClose:function(e){melisHelper.tabClose(e+"_id_meliscmsnews_page")},imageModal:function(e){$("#id_meliscmsnews_modal_documents_form_image_container").modal("hide"),melisHelper.zoneReload(e.cnews_id+"_id_meliscmsnews_content_tabs_properties_details_left_images","meliscmsnews_content_tabs_properties_details_left_images",{newsId:e.cnews_id})},fileModal:function(e){$("#id_meliscmsnews_modal_documents_form_image_container").modal("hide"),$("#id_meliscmsnews_modal_documents_form_container").modal("hide"),melisHelper.zoneReload(e.cnews_id+"_id_meliscmsnews_content_tabs_properties_details_left_documents","meliscmsnews_content_tabs_properties_details_left_documents",{newsId:e.cnews_id})},trimLength:function(e){return e=$.trim(e),e.length>15?(e=e.substring(0,15-"...".length),e.substring(0,e.lastIndexOf(" "))+"..."):e},progress:function(e){var t=$("div.progressContent");t.removeClass("hidden");var s=$("div.progressContent > div.progress > div.progress-bar");s.attr("aria-valuenow",0),s.css("width","0%");var i=$("div.progressContent > div.progress > span.status");if(i.html(""),e.lengthComputable){var a=e.total,n=e.loaded,o=100*n/a;s.attr("aria-valuenow",o),s.css("width",o+"%"),o>100?t.addClass("hidden"):i.html(Math.round(o)+"%")}}};window.newsImagePreview=function(e,t){if(t.files&&t.files[0]){var s=new FileReader;s.onload=function(t){$(e).attr("src",t.target.result)},s.readAsDataURL(t.files[0])}},window.initNewsList=function(e){var t=$("#newsSiteSelect");t.length&&(e.cnews_site_id=t.val())},function(e){"use strict";e.fn.bootstrapSwitch=function(t){var s='input[type!="hidden"]',i={init:function(){return this.each(function(){var t,i,a,n,o,l,r=e(this),c=r.closest("form"),d="",m=r.attr("class"),h="ON",f="OFF",_=!1,w=!1;e.each(["switch-mini","switch-small","switch-large"],function(e,t){m.indexOf(t)>=0&&(d=t)}),r.addClass("has-switch"),void 0!==r.data("on")&&(o="switch-"+r.data("on")),void 0!==r.data("on-label")&&(h=r.data("on-label")),void 0!==r.data("off-label")&&(f=r.data("off-label")),void 0!==r.data("label-icon")&&(_=r.data("label-icon")),void 0!==r.data("text-label")&&(w=r.data("text-label")),i=e("<span>").addClass("switch-left").addClass(d).addClass(o).html(h),o="",void 0!==r.data("off")&&(o="switch-"+r.data("off")),a=e("<span>").addClass("switch-right").addClass(d).addClass(o).html(f),n=e("<label>").html("&nbsp;").addClass(d).attr("for",r.find(s).attr("id")),_&&n.html('<i class="icon '+_+'"></i>'),w&&n.html(""+w),t=r.find(s).wrap(e("<div>")).parent().data("animated",!1),!1!==r.data("animated")&&t.addClass("switch-animate").data("animated",!0),t.append(i).append(n).append(a),r.find(">div").addClass(r.find(s).is(":checked")?"switch-on":"switch-off"),r.find(s).is(":disabled")&&e(this).addClass("deactivate");var p=function(e){r.parent("label").is(".label-change-switch")||e.siblings("label").trigger("mousedown").trigger("mouseup").trigger("click")};r.on("keydown",function(t){32===t.keyCode&&(t.stopImmediatePropagation(),t.preventDefault(),p(e(t.target).find("span:first")))}),i.on("click",function(t){p(e(this))}),a.on("click",function(t){p(e(this))}),r.find(s).on("change",function(t,s){var i=e(this),a=i.parent(),n=i.is(":checked"),o=a.is(".switch-off");if(t.preventDefault(),a.css("left",""),o===n){if(n?a.removeClass("switch-off").addClass("switch-on"):a.removeClass("switch-on").addClass("switch-off"),!1!==a.data("animated")&&a.addClass("switch-animate"),"boolean"==typeof s&&s)return;a.parent().trigger("switch-change",{el:i,value:n})}}),r.find("label").on("mousedown touchstart",function(t){var s=e(this);l=!1,t.preventDefault(),t.stopImmediatePropagation(),s.closest("div").removeClass("switch-animate"),s.closest(".has-switch").is(".deactivate")?s.unbind("click"):s.closest(".switch-on").parent().is(".radio-no-uncheck")?s.unbind("click"):(s.on("mousemove touchmove",function(t){var s=e(this).closest(".make-switch"),i=(t.pageX||t.originalEvent.targetTouches[0].pageX)-s.offset().left,a=i/s.width()*100;l=!0,a<25?a=25:a>75&&(a=75),s.find(">div").css("left",a-75+"%")}),s.on("click touchend",function(t){var s=e(this),i=e(t.target),a=i.siblings("input");t.stopImmediatePropagation(),t.preventDefault(),s.unbind("mouseleave"),l?a.prop("checked",!(parseInt(s.parent().css("left"))<-25)):a.prop("checked",!a.is(":checked")),l=!1,a.trigger("change")}),s.on("mouseleave",function(t){var s=e(this),i=s.siblings("input");t.preventDefault(),t.stopImmediatePropagation(),s.unbind("mouseleave"),s.trigger("mouseup"),i.prop("checked",!(parseInt(s.parent().css("left"))<-25)).trigger("change")}),s.on("mouseup",function(t){t.stopImmediatePropagation(),t.preventDefault(),e(this).unbind("mousemove")}))}),"injected"!==c.data("bootstrapSwitch")&&(c.bind("reset",function(){setTimeout(function(){c.find(".make-switch").each(function(){var t=e(this).find(s);t.prop("checked",t.is(":checked")).trigger("change")})},1)}),c.data("bootstrapSwitch","injected"))})},toggleActivation:function(){var t=e(this);t.toggleClass("deactivate"),t.find(s).prop("disabled",t.is(".deactivate"))},isActive:function(){return!e(this).hasClass("deactivate")},setActive:function(t){var i=e(this);t?(i.removeClass("deactivate"),i.find(s).removeAttr("disabled")):(i.addClass("deactivate"),i.find(s).attr("disabled","disabled"))},toggleState:function(t){var s=e(this).find(":checkbox");s.prop("checked",!s.is(":checked")).trigger("change",t)},toggleRadioState:function(t){var s=e(this).find(":radio");s.not(":checked").prop("checked",!s.is(":checked")).trigger("change",t)},toggleRadioStateAllowUncheck:function(t,s){var i=e(this).find(":radio");t?i.not(":checked").trigger("change",s):i.not(":checked").prop("checked",!i.is(":checked")).trigger("change",s)},setState:function(t,i){e(this).find(s).prop("checked",t).trigger("change",i)},setOnLabel:function(t){e(this).find(".switch-left").html(t)},setOffLabel:function(t){e(this).find(".switch-right").html(t)},setOnClass:function(t){var s=e(this).find(".switch-left"),i="";void 0!==t&&(void 0!==e(this).attr("data-on")&&(i="switch-"+e(this).attr("data-on")),s.removeClass(i),i="switch-"+t,s.addClass(i))},setOffClass:function(t){var s=e(this).find(".switch-right"),i="";void 0!==t&&(void 0!==e(this).attr("data-off")&&(i="switch-"+e(this).attr("data-off")),s.removeClass(i),i="switch-"+t,s.addClass(i))},setAnimated:function(t){var i=e(this).find(s).parent();void 0===t&&(t=!1),i.data("animated",t),i.attr("data-animated",t),!1!==i.data("animated")?i.addClass("switch-animate"):i.removeClass("switch-animate")},setSizeClass:function(t){var s=e(this),i=s.find(".switch-left"),a=s.find(".switch-right"),n=s.find("label");e.each(["switch-mini","switch-small","switch-large"],function(e,s){s!==t?(i.removeClass(s),a.removeClass(s),n.removeClass(s)):(i.addClass(s),a.addClass(s),n.addClass(s))})},status:function(){return e(this).find(s).is(":checked")},destroy:function(){var t,s=e(this),i=s.find("div"),a=s.closest("form");return i.find(":not(input)").remove(),t=i.children(),t.unwrap().unwrap(),t.unbind("change"),a&&(a.unbind("reset"),a.removeData("bootstrapSwitch")),t}};return i[t]?i[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist!"):i.init.apply(this,arguments)}}(jQuery);